<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AjaxTest01.html</title>
<link rel="stylesheet" type="text/css" href="css/main.css">
<!-- <link rel="stylesheet" type="text/css" href="css/style.css"> -->
<!-- <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script> -->
<script type="text/javascript">

function loadXMLDocs(params) {

    // XMLHttpRequest 객체 (→ AJAX 객체)를 담을 변수 선언
    //-- 호출하는 방법은 브라우저 마다 다르다~
    var xmlHttp;

    // (클라이언트 측) 브라우저의 종류나 상태에 따른 분기
    // (클라이언트 측에서) 자신이 브라우저가 XMLHttpRequest 를
    // 지원하고 있는 상황이라면...
    if (window.XMLHttpRequest) {
        console.log(">>> XMLHttpRequest 지원 브라우저");
        // 이와 같은 방법으로 객체를 생성하고(이렇게)
        xmlHttp = new XMLHttpRequest();
    } else {
        console.log(">>> XMLHttpRequest 미지원 브라우저");
        // 이와 같은 방법으로 객체를 생성해라(저렇게)
        xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    //-- >>> XMLHttpRequest 지원 브라우저
    
    // └> 여기까지의 수행은 클라이언트 브라우저 측에서(서버측 스태프(?)를 이용해) 수행하게 되는 것
    //--  원래 무대 팀 스태프가 해야할 일인데 -> 무대팀(이라는 이름)이 없다면,
    //--  연출팀(실제로 무대팀 일을 하는) 스태프 데려와서 일 시켜 라고 하는 것
    
    // ※ (사용자가 사용하는 브라우저에 따라.. ) 객체를 생성하는 방법의 차이만 있을 뿐
    //    여기까지 수행하면 XMLHttpRequest 객체(→ AJAX 객체) 생성 완료
    //--  뽑혀온 스태프가 하는 일은 동일할 것!(즉 AJAX 객체인 것)

    // 『xmlHttp』 : XMLHttpRequest 객체(→ AJAX 객체)
    // 서버로부터 응답이 오면 『readystatechange』 이벤트가 발생하게 된다.
    // 『onreadystatechange』: readystatechange 이벤트가 발생했을 때 동작할 수 있도록
    //   이벤트 핸들러(이벤트 리스너)를 등록하는 과정.
    //  즉, 이와 같은 이벤트가 발생하게 되면... 아래의 내용처럼 동작해라~

    // xmlHttp.onreadystatechange = 동작;
    // xmlHttp.onreadystatechange = 함수정의;
    xmlHttp.onreadystatechange  = function()
    {
        //  XMLHttpRequest 객체(→ AJAX 객체)의 상태값: readyState - 0 v 1 v 2 v 3 v 4
        //                                                           |   |   |  |
        //                                                          readystatechange 이벤트 발생
        // 응답이 올 때 마다
        // readyState 가 그 상황에서의 XMLHttpRequest 상태를 저장하게 된다.
        // 즉, readyState 는 XMLHttpRequest 객체의 property 이다.
        // ==> readystatechange 이벤트는 readyState 가 변경될 때 마다 발생하게 된다.
        //    └> 우리가 발생시킨 이벤트가 아님~
        //-- + ex) 피자 준비 중 ∥ 배달 준비 중 등 ∥주문받은 측이 알려줌. 주문자가 하는 것이 아님
        
        // ※ 『XMLHttpReauest』의 『readyState』는 0에서 4까지 순차적으로 변화한다.
        //    0 → 요청이 초기화 되지 않음
        //    1 → 서버 연결이 이루어지지 않음 
        //    2 → 요청이 수신됨
        //    3 → 요청을 처리중
        //    4 → 요청의 처리가 종료되고, 응답이 준비됨.
        //-- 에러든 뭐든 요청을 해야 받아서 알 수 있는 점
        
        // 서버로부터 응답을 받게 되면... (readyState 라는 property가 4 라면)
        if (xmlHttp.readyState == 4)
        {    
            // 『XMLHttpRequest』객체의 status 는 『HTTP Status』코드를 의미한다.
            //  200 → 올바른 응답
            //  40x → 클라이언트 측 에러(404 페이지 찾을 수 없음)
            //  50x → 서버측 에러 (JAVA → Servlet 에러)
            //-- 못하겠는데? 라는 것도 응답이기 때문에...
            //-- Informational responses (100 – 199)
            //-- Successful responses (200 – 299)
            //-- Redirection messages (300 – 399)
            //-- Client error responses (400 – 499)
            //-- Server error responses (500 – 599)
            //-- [HTTP response status codes](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status)
            if (xmlHttp.status == 200)
            {
                //-- 응답도 받았고 그 응답이 정상적일 때~
                // 이 구문을 통해 서버로부터 응답을 정상적으로 받았을 때
                // 그 응답을 가져와 DOM 을 업데이트 하겠다는 의미
                // 응답의 속성에는 두 가지가 있는데 //--(응답 방법이 2가지)
                // 『responseText』는 텍스트 형식의 응답일 경우 사용하게 되고
                // 『responseXML』은 응답이 XML 형식일 경우 사용하게 된다.
                // [XMLHttpRequest](https://developer.mozilla.org/ko/docs/Web/API/XMLHttpRequest)
                document.getElementById("myDiv").innerHTML = xmlHttp.responseText;
            }
        }
    };

    //-- 여기까지는 AJAX 객체의 설정만 해둔것 (~하고나서 ~하고 ~하고나서 ~하고..)
    //-- 아래의 코드들이 이제 설정한거 시작해줘! 하는 구문
    
    // 『XMLHttpRequest』의 『open("페이지 요청 방식", "URL", async)』는
    //  XMLHttpRequest 객체를 필요한 값으로 초기화 하는데 사용하는 메소드이다.
    //  GET 방식이 아닌 POST 방식으로 요청하기 위해서는
    // 『xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    //   xmlHttp.send(input1=value1&input2=value2);』
    //  와 같은 내용으로 헤더를 추가해 주어야 한다.
    xmlHttp.open("GET", "ajaxTarget.txt", true);
    //-- true : 비동기 / false : AJAX 안쓰겠다. 비동기 아님!
    //-- 이미 AJAX 객체 쓴다고 했는데 왜 있나..? -> 동의합니다 체크하는 것과 같음
    xmlHttp.send(""); //-- xmlHttp.send(); → AJAX 통신을 확실히 하기위애 xmlHttp.send("");
}

</script>
</head>
<body>

<div id="myDiv">
    <h1>AJAX를 활용하여 이 텍스트를 바꾸어보자.</h1>
</div>

<button type="button" onclick="loadXMLDocs()" class="btn">Content바꾸기</button>

</body>
</html>